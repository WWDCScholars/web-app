# Settings in the [build] context are global and are applied to all contexts
# unless otherwise overridden by more specific contexts.
[build]
  # Directory that contains the deploy-ready HTML files and assets generated by
  # the build. This is relative to the base directory if one has been set, or the
  # root directory if a base has not been set.
  publish = "dist/"

  # Default build command.
  command = "npm run build:prod"

  # Sentry Deploy Environment
  [build.environment]
    BASE_URL = "https://www.wwdcscholars.com"
    SENTRY_ENVIRONMENT= "production"

# Branch Deploy context: all deploys that are not from a pull/merge request or
# from the Production branch will inherit these settings.
[context.branch-deploy]
  command = "npm run build:stage"

  # Sentry Deploy Environment
  [context.branch-deploy.environment]
    SENTRY_ENVIRONMENT = "staging"

# Content-Security-Policy
[[headers]]
  for = "/*"
  [headers.values]
    Permissions-Policy = "interest-cohort=()"
    Content-Security-Policy-Report-Only = "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' *.apple-mapkit.com; connect-src *.wwdcscholars.com *.apple-cloudkit.com *.icloud.com *.apple-mapkit.com gsp10-ssl.ls.apple.com vimeo.com sentry.io; frame-src www.youtube-nocookie.com player.vimeo.com; img-src 'self' data: blob: *.icloud-content.com *.apple-mapkit.com img.youtube.com i.vimeocdn.com; font-src data:; child-src blob:; report-uri https://o74679.ingest.sentry.io/api/1462765/security/?sentry_key=b2d9a03750d74cec92f876941726c269"

# Redirect Netlify subdomain to primary domain
[[redirects]]
  from = "https://wwdcscholars.netlify.app"
  to = "https://www.wwdcscholars.com"
  status = 301
  force = true

# Redirect staging Netlify subdomain to staging primary domain
[[redirects]]
  from = "https://develop--wwdcscholars.netlify.app"
  to = "https://develop.wwdcscholars.com"
  status = 301
  force = true

# App Store Redirect
[[redirects]]
  from = "/app"
  to = "https://apps.apple.com/app/wwdcscholars/id1459158255?mt=8"
  status = 301
  force = true

# Discord Redirect
[[redirects]]
  from = "/discord"
  to = "https://discord.gg/XEBR9qWUpE"
  status = 301
  force = true

# Plausible Proxy
[[redirects]]
  from = "/stats/api/event"
  to = "https://plausible.io/api/event"
  status = 200
  force = true

# SPA History Pushstate
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
