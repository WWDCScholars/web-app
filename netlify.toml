# Settings in the [build] context are global and are applied to all contexts
# unless otherwise overridden by more specific contexts.
[build]
  # Directory that contains the deploy-ready HTML files and assets generated by
  # the build. This is relative to the base directory if one has been set, or the
  # root directory if a base has not been set.
  publish = "dist/"

  # Default build command.
  command = "npm run build:prod"

# Branch Deploy context: all deploys that are not from a pull/merge request or
# from the Production branch will inherit these settings.
[context.branch-deploy]
  command = "npm run build:stage"

# Content-Security-Policy
[[headers]]
  for = "/*"
  [headers.values]
    Content-Security-Policy-Report-Only = "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' *.apple-mapkit.com; connect-src stats.wwdcscholars.com api.apple-cloudkit.com *.apple-mapkit.com; frame-src 'none'; img-src 'self' *.icloud-content.com *.apple-mapkit.com; font-src data:; report-uri https://o74679.ingest.sentry.io/api/1462765/security/?sentry_key=b2d9a03750d74cec92f876941726c269"

# Redirect Netlify subdomain to primary domain
[[redirects]]
  from = "https://wwdcscholars.netlify.app"
  to = "https://www.wwdcscholars.com"
  status = 301
  force = true

# Redirect staging Netlify subdomain to staging primary domain
[[redirects]]
  from = "https://develop--wwdcscholars.netlify.app"
  to = "https://develop.wwdcscholars.com"
  status = 301
  force = true

# App Store Redirect
[[redirects]]
  from = "/app"
  to = "https://apps.apple.com/app/wwdcscholars/id1459158255?mt=8"
  status = 301
  force = true

# Discord Redirect
[[redirects]]
  from = "/discord"
  to = "https://discord.gg/Vn5bHDg"
  status = 301
  force = true

# SPA History Pushstate
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
